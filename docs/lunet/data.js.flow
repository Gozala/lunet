// @flow strict

export type RequestData = {
  url: string,
  destination: string,
  body: ?ArrayBuffer,
  cache?: CacheType,
  credentials?: CredentialsType,
  headers?: HeadersInit,
  integrity?: string,
  keepalive?: boolean,
  method?: string,
  mode?: ?ModeType,
  redirect?: RedirectType,
  referrer?: string,
  referrerPolicy?: ReferrerPolicyType
}

export type ResponseData = {
  url: string,
  body: ArrayBuffer,
  status: number,
  statusText: string,
  headers: HeadersInit,
  redirected: boolean,
  type: ResponseType
}

type Transferable = ArrayBuffer | MessagePort | ImageBitmap

export type RequestMessage = {
  type: "request",
  id: number,
  request: RequestData,
  transfer: Transferable[]
}

export type ResponseMessage = {
  type: "response",
  id: number,
  response: ResponseData,
  transfer: Transferable[]
}

export type Response = {
  type: "message",
  data: ResponseMessage,
  ports: MessagePort[],
  source: ServiceWorker
}

export type Request = {
  type: "message",
  data: RequestMessage,
  ports: MessagePort[],
  source: WindowProxy,
  origin: string
}
